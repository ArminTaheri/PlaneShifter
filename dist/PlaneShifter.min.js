// Build date: 2017-065T11:01:45

/*
* Author    Jonathan Lurie - http://me.jonahanlurie.fr
* License   MIT
* Link      https://github.com/jonathanlurie/PlaneShifter
* Lab       MCIN - http://mcin.ca/ - Montreal Neurological Institute
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[c]=b.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var c=0;return $jscomp.iteratorPrototype(function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,c){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var b=0,d={next:function(){if(b<a.length){var e=b++;return{value:c(e,a[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(a,c,b,d){if(c){b=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];e in b||(b[e]={});b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&$jscomp.defineProperty(b,a,{configurable:!0,writable:!0,value:c})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(c){return c})}},"es6-impl","es3");
$jscomp.polyfill("Math.sign",function(a){return a?a:function(c){c=Number(c);return 0===c||isNaN(c)?c:0<c?1:-1}},"es6-impl","es3");
(function(a,c){"object"===typeof exports&&"undefined"!==typeof module?c(exports):"function"===typeof define&&define.amd?define(["exports"],c):c(a.PlaneShifter=a.PlaneShifter||{})})(this,function(a){var c=function(b,c,a){a=void 0===a?null:a;THREE?(this._planeContainer=b,this._camera=c,this._control=a,this._mouse=new THREE.Vector2(Infinity,Infinity),this._pointClicked2D=this._pointClicked3D=null,this._raycaster=new THREE.Raycaster,this._cameraFollowObject=!1,this._keyPressed={},this._originalDistanceToCam=
this._camera.position.clone().sub(this._planeContainer.position).length(),this._boundingBox=new THREE.Box3(new THREE.Vector3(-Infinity,-Infinity,-Infinity),new THREE.Vector3(Infinity,Infinity,Infinity)),this._rotateConfig={},this._shiftConfig={},this._states={IDLE:0,TRANSLATION:1,ROTATION:2},this._activeState=this._states.IDLE,this._keysStates={KeyT:this._states.TRANSLATION,KeyR:this._states.ROTATION},this._initNormals(),this._initEvents()):console.error("THREE (from THREE js) must be defined.")};
c.prototype.setBoundingBox=function(b){this._boundingBox=b.clone()};c.prototype._initNormals=function(){this._planeContainer.children.forEach(function(b){b.normalV=(new THREE.Vector3(0,0,1)).applyQuaternion(b.quaternion).normalize()})};c.prototype._initEvents=function(){window.addEventListener("mousemove",this._onMouseMove.bind(this),!1);window.addEventListener("mousedown",this._onMouseDown.bind(this),!1);window.addEventListener("mouseup",this._onMouseUp.bind(this),!1);window.addEventListener("keyup",
this._onKeyUp.bind(this),!1);window.addEventListener("keydown",this._onKeyDown.bind(this),!1)};c.prototype._onMouseMove=function(b){this._mouse.x=event.clientX/window.innerWidth*2-1;this._mouse.y=2*-(event.clientY/window.innerHeight)+1;this._followInteraction()};c.prototype._onMouseDown=function(b){this._keyPressed.mouse=!0;this._activeState!=this._states.IDLE&&this._raycast()};c.prototype._onMouseUp=function(b){this._interacting=this._keyPressed.mouse=!1};c.prototype._isKeyPressed=function(b){return b in
this._keyPressed&&this._keyPressed[b]};c.prototype._onKeyUp=function(b){this._keyPressed[b.code]=!1;this._evaluateCurentState()};c.prototype._onKeyDown=function(b){this._keyPressed[b.code]=!0;this._evaluateCurentState()};c.prototype._evaluateCurentState=function(){this._activeState=this._states.IDLE;for(var b=Object.keys(this._keysStates),a=0;a<b.length;a++)if(b[a]in this._keyPressed&&this._keyPressed[b[a]]){this._activeState=this._keysStates[b[a]];break}this._activeState==this._states.IDLE?this._enableControl():
this._disableControl()};c.prototype.setCameraFollowObject=function(b){this._cameraFollowObject=b};c.prototype._getScreenCoord=function(b){b=b.clone();b.project(this._camera);return new THREE.Vector2(b.x,b.y)};c.prototype._raycast=function(){this._raycaster.setFromCamera(this._mouse,this._camera);for(var b=this._raycaster.intersectObject(this._planeContainer,!0),a=0;a<b.length;a++)if(this._boundingBox.containsPoint(b[a].point)){switch(this._activeState){case this._states.TRANSLATION:this._castedRayForTranslation(b[a]);
break;case this._states.ROTATION:this._castedRayForRotation(b[a])}break}};c.prototype._castedRayForTranslation=function(b){this._interacting=!0;var a=b.object;this._shiftConfig.originalObjectPosition=this._planeContainer.position.clone();this._shiftConfig.hitPoint3D=b.point.clone();this._shiftConfig.hitPoint2D=this._mouse.clone();this._shiftConfig.planeNormalInternal3D=a.normalV.clone();this._shiftConfig.planeNormalWorld3D=a.normalV.clone().applyQuaternion(this._planeContainer.quaternion).normalize();
this._shiftConfig.topPoint3D=this._shiftConfig.hitPoint3D.clone().add(this._shiftConfig.planeNormalWorld3D);this._shiftConfig.topPoint2D=this._getScreenCoord(this._shiftConfig.topPoint3D);this._shiftConfig.planeNormal2D=new THREE.Vector2(this._shiftConfig.topPoint2D.x-this._shiftConfig.hitPoint2D.x,this._shiftConfig.topPoint2D.y-this._shiftConfig.hitPoint2D.y);this._shiftConfig.hitPoint3DInternal=this._planeContainer.worldToLocal(b.point.clone())};c.prototype._followInteraction=function(){if(this._interacting)switch(this._activeState){case this._states.TRANSLATION:this._followTranslation();
break;case this._states.ROTATION:this._followRotation()}};c.prototype._followTranslation=function(){var b=new THREE.Vector2(this._mouse.x-this._shiftConfig.hitPoint2D.x,this._mouse.y-this._shiftConfig.hitPoint2D.y);this._camera.position.clone().sub(this._planeContainer.position).length();var a=this._shiftConfig.planeNormal2D.length(),b=b.dot(this._shiftConfig.planeNormal2D.clone().normalize())/a,b=this._shiftConfig.planeNormalWorld3D.clone().multiplyScalar(b),a=new THREE.Vector3(this._shiftConfig.originalObjectPosition.x+
b.x,this._shiftConfig.originalObjectPosition.y+b.y,this._shiftConfig.originalObjectPosition.z+b.z);this._boundingBox.containsPoint(a)&&this._planeContainer.position.set(this._shiftConfig.originalObjectPosition.x+b.x,this._shiftConfig.originalObjectPosition.y+b.y,this._shiftConfig.originalObjectPosition.z+b.z);this._cameraFollowObject&&this._camera.lookAt(this._planeContainer.position)};c.prototype._disableControl=function(){this._control&&(this._control.enabled&&this._saveOrbitData(),this._control.enabled=
!1)};c.prototype._enableControl=function(){this._control&&!this._control.enabled&&(this._control.enabled=!0,this._restoreOrbitData())};c.prototype._saveOrbitData=function(){this._orbitData={target:new THREE.Vector3,position:new THREE.Vector3,zoom:this._control.object.zoom};this._orbitData.target.copy(this._control.target);this._orbitData.position.copy(this._control.object.position)};c.prototype._restoreOrbitData=function(){this._control.position0.copy(this._orbitData.position);this._cameraFollowObject?
this._control.target0.copy(this._planeContainer.position):this._control.target0.copy(this._orbitData.target);this._control.zoom0=this._orbitData.zoom;this._control.reset()};c.prototype._castedRayForRotation=function(b){this._interacting=!0;b=b.object;this._rotateConfig.originalObjectRotation=this._planeContainer.rotation.clone();this._rotateConfig.hitPoint2D=this._mouse.clone();this._rotateConfig.planeNormalInternal3D=b.normalV.clone();this._rotateConfig.planeNormalWorld3D=b.normalV.clone().applyQuaternion(this._planeContainer.quaternion).normalize();
this._rotateConfig.center3D=this._planeContainer.getWorldPosition();this._rotateConfig.center2D=this._getScreenCoord(this._rotateConfig.center3D);this._rotateConfig.cameraObjectVector=(new THREE.Vector3(this._camera.position.x-this._rotateConfig.center3D.x,this._camera.position.y-this._rotateConfig.center3D.y,this._camera.position.z-this._rotateConfig.center3D.z)).normalize();this._rotateConfig.cameraSign=Math.sign(this._rotateConfig.planeNormalWorld3D.dot(this._rotateConfig.cameraObjectVector))};
c.prototype._followRotation=function(){var b=this._rotateConfig.center2D,a=this._rotateConfig.hitPoint2D,c=this._mouse.clone(),a=(new THREE.Vector3(a.x-b.x,a.y-b.y,a.z-b.z)).normalize(),c=(new THREE.Vector3(c.x-b.x,c.y-b.y,c.z-b.z)).normalize(),b=Math.acos(a.dot(c)),a=Math.sign(a.cross(c).z);this._planeContainer.rotation.set(this._rotateConfig.originalObjectRotation.x,this._rotateConfig.originalObjectRotation.y,this._rotateConfig.originalObjectRotation.z);this._planeContainer.rotateOnAxis(this._rotateConfig.planeNormalInternal3D,
b*a*this._rotateConfig.cameraSign)};a.PlaneShifter=c;Object.defineProperty(a,"__esModule",{value:!0})});
