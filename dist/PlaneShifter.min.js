// Build date: 2017-0612T12:05:16

/*
* Author    Jonathan Lurie - http://me.jonahanlurie.fr
* License   MIT
* Link      https://github.com/jonathanlurie/PlaneShifter
* Lab       MCIN - http://mcin.ca/ - Montreal Neurological Institute
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(c,a,b){if(b.get||b.set)throw new TypeError("ES3 does not support getters and setters.");c!=Array.prototype&&c!=Object.prototype&&(c[a]=b.value)};$jscomp.getGlobal=function(c){return"undefined"!=typeof window&&window===c?c:"undefined"!=typeof global&&null!=global?global:c};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(c){return $jscomp.SYMBOL_PREFIX+(c||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var c=$jscomp.global.Symbol.iterator;c||(c=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[c]&&$jscomp.defineProperty(Array.prototype,c,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(c){var a=0;return $jscomp.iteratorPrototype(function(){return a<c.length?{done:!1,value:c[a++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(c){$jscomp.initSymbolIterator();c={next:c};c[$jscomp.global.Symbol.iterator]=function(){return this};return c};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(c,a){$jscomp.initSymbolIterator();c instanceof String&&(c+="");var b=0,d={next:function(){if(b<c.length){var e=b++;return{value:a(e,c[e]),done:!1}}d.next=function(){return{done:!0,value:void 0}};return d.next()}};d[Symbol.iterator]=function(){return d};return d};
$jscomp.polyfill=function(c,a,b,d){if(a){b=$jscomp.global;c=c.split(".");for(d=0;d<c.length-1;d++){var e=c[d];e in b||(b[e]={});b=b[e]}c=c[c.length-1];d=b[c];a=a(d);a!=d&&null!=a&&$jscomp.defineProperty(b,c,{configurable:!0,writable:!0,value:a})}};$jscomp.polyfill("Array.prototype.keys",function(c){return c?c:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
$jscomp.polyfill("Math.sign",function(c){return c?c:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");
(function(c,a){"object"===typeof exports&&"undefined"!==typeof module?a(exports):"function"===typeof define&&define.amd?define(["exports"],a):a(c.PlaneShifter=c.PlaneShifter||{})})(this,function(c){var a=function(b,a,c,f){f=void 0===f?null:f;THREE?(this._planeContainer=b,this._camera=a,this._controls=c,this._useReferenceMouse=!!f,this._mouse=f?f:new THREE.Vector2(Infinity,Infinity),this._pointClicked2D=this._pointClicked3D=null,this._raycaster=new THREE.Raycaster,this._cameraFollowObject=!1,this._keyPressed=
{},this._originalDistanceToCam=this._camera.position.clone().sub(this._planeContainer.position).length(),this._boundingBox=new THREE.Box3(new THREE.Vector3(-Infinity,-Infinity,-Infinity),new THREE.Vector3(Infinity,Infinity,Infinity)),this._rotateConfig={},this._shiftConfig={},this._states={IDLE:0,TRANSLATION:1,ROTATION:2},this._activeState=this._states.IDLE,this._keysStates={KeyT:this._states.TRANSLATION,KeyR:this._states.ROTATION},this._initNormals(),this._initEvents()):console.error("THREE (from THREE js) must be defined.")};
a.prototype.setBoundingBox=function(b){this._boundingBox=b.clone()};a.prototype._initNormals=function(){this._planeContainer.children.forEach(function(b){b.normalV=(new THREE.Vector3(0,0,1)).applyQuaternion(b.quaternion).normalize()})};a.prototype._initEvents=function(){window.addEventListener("mousemove",this._onMouseMove.bind(this),!1);window.addEventListener("mousedown",this._onMouseDown.bind(this),!1);window.addEventListener("mouseup",this._onMouseUp.bind(this),!1);window.addEventListener("keyup",
this._onKeyUp.bind(this),!1);window.addEventListener("keydown",this._onKeyDown.bind(this),!1)};a.prototype._onMouseMove=function(b){this._useReferenceMouse||(this._mouse.x=event.clientX/window.innerWidth*2-1,this._mouse.y=2*-(event.clientY/window.innerHeight)+1);this._followInteraction()};a.prototype._onMouseDown=function(b){this._keyPressed.mouse=!0;this._activeState!=this._states.IDLE&&this._raycast()};a.prototype._onMouseUp=function(b){this._interacting=this._keyPressed.mouse=!1};a.prototype._isKeyPressed=
function(b){return b in this._keyPressed&&this._keyPressed[b]};a.prototype._onKeyUp=function(b){this._keyPressed[b.code]=!1;this._evaluateCurentState()};a.prototype._onKeyDown=function(b){this._keyPressed[b.code]=!0;this._evaluateCurentState()};a.prototype._evaluateCurentState=function(){this._activeState=this._states.IDLE;for(var b=Object.keys(this._keysStates),a=0;a<b.length;a++)if(b[a]in this._keyPressed&&this._keyPressed[b[a]]){this._activeState=this._keysStates[b[a]];break}this._activeState==
this._states.IDLE?this._enableControl():this._disableControl()};a.prototype.setCameraFollowObject=function(b){this._cameraFollowObject=b};a.prototype._getScreenCoord=function(b){b=b.clone();b.project(this._camera);return new THREE.Vector2(b.x,b.y)};a.prototype._raycast=function(){this._raycaster.setFromCamera(this._mouse,this._camera);for(var b=this._raycaster.intersectObject(this._planeContainer,!0),a=0;a<b.length;a++)if(this._boundingBox.containsPoint(b[a].point)){switch(this._activeState){case this._states.TRANSLATION:this._castedRayForTranslation(b[a]);
break;case this._states.ROTATION:this._castedRayForRotation(b[a])}break}};a.prototype._castedRayForTranslation=function(b){this._interacting=!0;var a=b.object;this._shiftConfig.originalObjectPosition=this._planeContainer.position.clone();this._shiftConfig.hitPoint3D=b.point.clone();this._shiftConfig.hitPoint2D=this._mouse.clone();this._shiftConfig.planeNormalInternal3D=a.normalV.clone();this._shiftConfig.planeNormalWorld3D=a.normalV.clone().applyQuaternion(this._planeContainer.quaternion).normalize();
this._shiftConfig.topPoint3D=this._shiftConfig.hitPoint3D.clone().add(this._shiftConfig.planeNormalWorld3D);this._shiftConfig.topPoint2D=this._getScreenCoord(this._shiftConfig.topPoint3D);this._shiftConfig.planeNormal2D=new THREE.Vector2(this._shiftConfig.topPoint2D.x-this._shiftConfig.hitPoint2D.x,this._shiftConfig.topPoint2D.y-this._shiftConfig.hitPoint2D.y);this._shiftConfig.hitPoint3DInternal=this._planeContainer.worldToLocal(b.point.clone())};a.prototype._followInteraction=function(){if(this._interacting)switch(this._activeState){case this._states.TRANSLATION:this._followTranslation();
break;case this._states.ROTATION:this._followRotation()}};a.prototype._followTranslation=function(){var b=new THREE.Vector2(this._mouse.x-this._shiftConfig.hitPoint2D.x,this._mouse.y-this._shiftConfig.hitPoint2D.y);this._camera.position.clone().sub(this._planeContainer.position).length();var a=this._shiftConfig.planeNormal2D.length(),b=b.dot(this._shiftConfig.planeNormal2D.clone().normalize())/a,b=this._shiftConfig.planeNormalWorld3D.clone().multiplyScalar(b),a=new THREE.Vector3(this._shiftConfig.originalObjectPosition.x+
b.x,this._shiftConfig.originalObjectPosition.y+b.y,this._shiftConfig.originalObjectPosition.z+b.z);this._boundingBox.containsPoint(a)&&this._planeContainer.position.set(this._shiftConfig.originalObjectPosition.x+b.x,this._shiftConfig.originalObjectPosition.y+b.y,this._shiftConfig.originalObjectPosition.z+b.z);this._cameraFollowObject&&this._camera.lookAt(this._planeContainer.position)};a.prototype._disableControl=function(){this._controls&&(this._controls.enabled&&this._saveOrbitData(),this._controls.enabled=
!1)};a.prototype._enableControl=function(){this._controls&&!this._controls.enabled&&(this._controls.enabled=!0,this._restoreOrbitData())};a.prototype._saveOrbitData=function(){this._orbitData={target:new THREE.Vector3,position:new THREE.Vector3,zoom:this._controls.object.zoom};this._orbitData.target.copy(this._controls.target);this._orbitData.position.copy(this._controls.object.position)};a.prototype._restoreOrbitData=function(){this._controls.position0.copy(this._orbitData.position);this._cameraFollowObject?
this._controls.target0.copy(this._planeContainer.position):this._controls.target0.copy(this._orbitData.target);this._controls.zoom0=this._orbitData.zoom;this._controls.reset()};a.prototype._castedRayForRotation=function(b){this._interacting=!0;b=b.object;this._rotateConfig.originalObjectRotation=this._planeContainer.rotation.clone();this._rotateConfig.hitPoint2D=this._mouse.clone();this._rotateConfig.planeNormalInternal3D=b.normalV.clone();this._rotateConfig.planeNormalWorld3D=b.normalV.clone().applyQuaternion(this._planeContainer.quaternion).normalize();
this._rotateConfig.center3D=this._planeContainer.getWorldPosition();this._rotateConfig.center2D=this._getScreenCoord(this._rotateConfig.center3D);this._rotateConfig.cameraObjectVector=(new THREE.Vector3(this._camera.position.x-this._rotateConfig.center3D.x,this._camera.position.y-this._rotateConfig.center3D.y,this._camera.position.z-this._rotateConfig.center3D.z)).normalize();this._rotateConfig.cameraSign=Math.sign(this._rotateConfig.planeNormalWorld3D.dot(this._rotateConfig.cameraObjectVector))};
a.prototype._followRotation=function(){var b=this._rotateConfig.center2D,a=this._rotateConfig.hitPoint2D,c=this._mouse.clone(),a=(new THREE.Vector3(a.x-b.x,a.y-b.y,a.z-b.z)).normalize(),c=(new THREE.Vector3(c.x-b.x,c.y-b.y,c.z-b.z)).normalize(),b=Math.acos(a.dot(c)),a=Math.sign(a.cross(c).z);this._planeContainer.rotation.set(this._rotateConfig.originalObjectRotation.x,this._rotateConfig.originalObjectRotation.y,this._rotateConfig.originalObjectRotation.z);this._planeContainer.rotateOnAxis(this._rotateConfig.planeNormalInternal3D,
b*a*this._rotateConfig.cameraSign)};c.PlaneShifter=a;Object.defineProperty(c,"__esModule",{value:!0})});
